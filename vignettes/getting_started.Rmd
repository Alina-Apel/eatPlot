---
title: "Getting Started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{lineplots}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(eatPlot)
```

`eatPlot` takes output dataframes from `eatRep` and facilitates the construction of different `ggplot2`-plots for the data. Main goal is the plotting of BT22 graphs, but in general the package can be used for other purposes as well. 
The packages aim is it to make the plotting as easy but flexible as possible, so let's dive right in!

# Basic workflow
## Data preperation
The first step is the data preperation. This is handeled by the function `prep_plot()`:
```{r}
dat_plot <- prep_plot(trend_books, 
                      grouping_var = "KBuecher_imp3" 
                      )
```

Here we choose the dataframe `trend_books` (which is an example included in the package), and define the column `KBuecher_imp3` as grouping variable. A lot of the function arguments are predefined with sensible defaults. If they don't fit your data, use `?prep_plot` to find out more about the specific settings. 
The result is a large list consisting of different data.frames, each data.frame containing the prepared data for a different plot type. Normally, you don't have to look at this list, but in some cases you might want to edit the data by hand to fit your purpose.

This concludes the basic data preperation workflow. Consult `vignette("data_preperation")` or `prep_plot()` for further information. 


# Plotting
Different predefined plottypes stemming from the BT22 graphs are available. In general, the `eatPlot`-functions can also be combined to create additional plots, however, the functions have been optimized in regards to the BT22-needs.

## Plot settings
One major goal of `eatPlot` is the automatisation of plotting the BT22 graphs. Even though this can be achieved by only one or two functions, different plots require different settings for alignments, plot sizes, filling colours and more. However, the settings also need to be as flexible as possible, so new plots can be easily incorporated as well. 
To provide default plotsettings, `eatPlot` contains multiple lists with predefined plot settings for different plot types. At the same time, `plotsettings_lineplot()` or `plotsettings_tablebarplot()` are functions which facilitate the generation of new lists with altered settings. See `vignette("plot_settings")` for further instructions on altering your own plots. 

## Lineplots
Lineplots are plotted using the `plot_lineplot()` function. Input data is the list of data.frames prepated by `prep_plot()`.

```{r}
plot_lineplot(dat_plot)
```


## Tables and barplots
Multiple plots in the BT22 consist of tables, barplots or a combination of both. In general, tables and barplots with the same y-axis can be combined into more complex plots. As often both tables and barplots need to be combined to the same plot, the function `plot_tablebar()` is responsible for both operations. 

The function takes either the whole list-object generated by `prep_plot()` or the according `data.frame` `plot_tablebar`. This way, you can extract and edit the `plot_tablebar` `data.frame` yourself, e.g. if some specific rows have to be removed:

```{r}
dat_plot_2011 <- subset(dat_plot$plot_tablebar, year_start == 2011)
dat_plot_2011 <- subset(dat_plot_2011, year_end == 2016)
dat_plot_2011 <- subset(dat_plot_2011, competence_var == "lesen")
dat_plot_2011 <- subset(dat_plot_2011, grouping_var == 0)
```


When we have cleaned our data, we can plot a tablebarplot by providing variables that should be plotted as table columns, as well as the headers, and default settings (if needed). 
```{r}
plot_tablebar(dat = dat_plot_2011,
              bar_est = "est_Trend_CompWhole",
              bar_header = "Wert",
              columns_headers = c("Land", "Jahr", "Wert"),
              columns_table = c("state_var", "year_start", "est_noTrendStart_noComp"),
              y_axis = "state_var",
              plot_settings = plotsettings_tablebarplot(axis_x_lims = c(-30, 30),
                                                        columns_alignment = c(0,0.5, 0.5),
                                                        columns_width = c(0.1, 0.1, 0.1, 0.7),
                                                        default_list = barplot_MinSta)
              )
```
Note that we have to change the column alignment here, so the column values are aligned correctly, and that we have to change the column width, if we don't want alle columns to have the same size.   


## Combining tables and barplots
Currently, `eatPlot` only supports the generation of a table with the desired number of columns, and one barplot on the right side of the table. For very complex plots, different plots have to be combined cleverly to achieve the desired output. 
